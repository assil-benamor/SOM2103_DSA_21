rm(list = ls())

if (!require("pacman")) install.packages("pacman")
p_load(rio,
       tidyverse,
       koboquest,
       crayon,
       hypegrammaR,
       composr,
       clipr)

source("src/functions/data_merge_functions.R")
source("src/functions/data_merge_generator.R")

data <- read.csv("output/Indicators/aggregation_output_plus_lsg.csv",stringsAsFactors = F,na.strings = c(""," ","NA","#N/A"))

# data <- data %>% setnames(old = c("buul", "solid_apartment", "unfinished", "make_shift", "none"), 
#                           new = c("hh_living_in_buul", "hh_living_in_solid_apartment", "hh_living_in_unfinished", "hh_living_in_make_shift", "hh_living_in_none"))
# 



koboToolPath = "input/tool/REACH_SOM_DSA_Survey_Tool_for_results_table.xlsx"

questions = import(koboToolPath,sheet="survey") %>% select(-1) %>% filter(!is.na(name))

choices = import(koboToolPath,sheet="choices")

questionnaire <- load_questionnaire(data = data,
                                    questions = questions,
                                    choices = choices,
                                    choices.label.column.to.use = "label::English (en)")

data$weights = 1
data$national <- "national"

data <- data %>% mutate_at(
c("water_access_distance_min", 
  "sanitation_access_distance_min", 
  "health_access_distance_min",
  "nutrition_access_distance_min",
  "education_access_distance_min", 
  "foodsecurity_access_distance_min"),
function(x){
  case_when(
    is.na(x) ~ x,
    x == "1530" ~ "15_30",
    x == "3160" ~ "31_60",
    TRUE ~ x
    
  )
}
)

data[data=="NC"] <- NA

data <- data %>% filter(localisation_district_label!="") 
# data_merge <- data %>% select(-localisation_region,-district)

indicators_to_include <- c("cccm_populationestimates_families", "cccm_populationestimates_individuals", "cccm_idps_arrived", "cccm_idps_departed", "cccm_idps_origin_first", "cccm_district_origin_first", "reason_displacement", "cccm_management", "cccm_committees", "decision_making_committees", "foodsecurity_access", "foodsecurity_access_distance_min", "foodsecurity_primary", "foodsecurity_coping_food", "foodsecurity_access_barriers", "nutrition_access_distance_min", "nutrition_distributions", "nutrition_services", "health_access_distance_min", "health_women_unskilledhealthpersonnel", "health_services", "health_facilities", "protection_childfriendlyspace", "protection_womenspace", "protection_restrictions_day", "protection_incidents", "insecure_areas", "support_access_impediments", "housing_property_incidences", "rate_likelihood_eviction", "evictions_landowner", "hlp_nc_index2", "none", "nfi_nc_index3", "shelter_types", "nfi_nc_index1", "nfi_items_available", "nfi_nc_index4", "water_access_distance_min", "water_sources_primary", "wash_nc_index3", "water_access_barriers", "sanitation_access_distance_min", "latrines_accessible_pwd", "sanitation_solidwastedisposal", "sanitation_access_impediments", "hygiene_handwashingfacilities", "number_schools_opened", "education_access_distance_min", "education_facilities", "education_barriers_girls", "education_barriers_boys", "aap_informationsources", "aap_informationsources_pwd", "aap_access_barriers", "aap_feedbackmechanism", "covid_issue", "action_to_prevent")

indicators_to_include <- c(indicators_to_include,c("snfi_score", "wash_score", "protection_score", "fs_score", "health_score", "nutrition_score", "education_score", "hlp_score") )

# data_merge <- data %>% select(starts_with(indicators_to_include))

data[data=="NC"] <- NA

##################X
# data_merge_gen generates the differnet variables nedded for data merge depending on the 
# variables type:
# - Numerical : Calculate the average of the variable 
# - Select one/multiple : create a variable for each tuple (question,answer) with the %
#  and if the questions has more than 3 answers create top 4 answers variables with the labels and %
#  Note that this function does not run the analysis, it just returns the code to be used 
#  the code will be copied directely to the clipboard, so after you run it juste paste it into 
#  the script (eg: District level data and National level data)

################## X

l <- list(
  question = c("cccm_populationestimates_families", "cccm_populationestimates_individuals", "cccm_idps_arrived", "cccm_idps_departed", "cccm_idps_origin_first", "cccm_district_origin_first", "reason_displacement", "cccm_management", "cccm_committees", "decision_making_committees", "foodsecurity_access", "foodsecurity_access_distance_min", "foodsecurity_primary", "foodsecurity_coping_food", "foodsecurity_access_barriers", "nutrition_access_distance_min", "nutrition_distributions", "nutrition_services", "health_access_distance_min", "health_women_unskilledhealthpersonnel", "health_services", "health_facilities", "protection_childfriendlyspace", "protection_womenspace", "protection_restrictions_day", "protection_incidents", "insecure_areas", "support_access_impediments", "housing_property_incidences", "rate_likelihood_eviction", "evictions_landowner", "hlp_nc_index2", "none", "nfi_nc_index3", "shelter_types", "nfi_nc_index1", "nfi_items_available", "nfi_nc_index4", "water_access_distance_min", "water_sources_primary", "wash_nc_index3", "water_access_barriers", "sanitation_access_distance_min", "latrines_accessible_pwd", "sanitation_solidwastedisposal", "sanitation_access_impediments", "hygiene_handwashingfacilities", "number_schools_opened", "education_access_distance_min", "education_facilities", "education_barriers_girls", "education_barriers_boys", "aap_informationsources", "aap_informationsources_pwd", "aap_access_barriers", "aap_feedbackmechanism", "covid_issue", "action_to_prevent"),
  type = c("sum", "sum", "mean", "mean", "top3", "top3", "top3", "pct", "pct", "pct", "pct", "pct", "top3", "top3", "top3", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "pct", "top3", "pct", "top3", "pct", "pct", "top3", "pct", "top3", "pct", "pct", "pct", "top3", "pct", "pct", "pct", "pct", "top3", "top3", "top3", "top3", "top3", "pct", "pct", "pct")
)


clipr::write_clip(data_merge_gen_v2(data= data,
                                 questionnaire = questionnaire,
                                 questions = questions,
                                 liste_of_questions = indicators_to_include ,
                                 choices = choices,
                                 group = "localisation_district_label",
                                 df_name = "data",
                                 df_output_name = "data_merge_ditrict"))


clipr::write_clip(data_merge_gen_v2(data= data,
                                 questionnaire = questionnaire,
                                 questions = questions,
                                 liste_of_questions = indicators_to_include,
                                 choices = choices,
                                 group = "national",
                                 df_name = "data",
                                 df_output_name = "data_merge_national"))



data <- data %>% mutate_at(c("wash_index1", "wash_index2", "wash_index3", "wash_index4", "wash_nc_index", "wash_nc_index2", "wash_nc_index3", "wash_nc_index4", "wash_nc_index5", "protection_index1", "protection_index2", "protection_nc_index1", "protection_nc_index2", "protection_nc_index3", "protection_nc_index4", "protection_nc_index5", "education_nc_index1", "education_nc_index2", "education_nc_index3", "education_nc_index4", "education_nc_index5", "education_nc_index6", "education_nc_index7", "education_nc_index8", "education_nc_index9", "education_index1", "education_index2", "health_index1", "health_index2", "health_index3", "health_index4", "health_nc_index1", "health_nc_index2", "health_nc_index3", "health_nc_index4", "health_nc_index5", "health_nc_index6", "health_nc_index7", "health_nc_index8", "health_nc_index9", "health_nc_index10", "health_nc_index11", "health_nc_index12", "health_nc_index13", "nutrition_nc_index1", "nutrition_nc_index2", "nutrition_nc_index3", "nfi_index1", "nfi_nc_index1", "nfi_nc_index2", "nfi_nc_index3", "nfi_nc_index4", "nfi_nc_index5", "nfi_nc_index6", "hlp_index1", "hlp_index2", "hlp_index3", "hlp_nc_index1", "hlp_nc_index2", "food_sec_index2", "food_sec_index3", "food_sec_nc_index1", "food_sec_nc_index2", "food_sec_nc_index3", "food_sec_nc_index4", "food_sec_nc_index5", "food_sec_nc_index6", "food_sec_nc_index7", "food_sec_nc_index8", "mean_nc_snfi", "mean_nc_wash", "mean_nc_hlt", "mean_nc_nutrition", "mean_nc_fs", "mean_nc_edu", "mean_nc_protection", "mean_nc_hlp", "snfi_score", "wash_score", "protection_score", "fs_score", "health_score", "nutrition_score", "education_score", "hlp_score", "protection_need", "education_need", "nutrition_need", "fs_need", "snfi_need", "wash_need", "health_need", "hlp_need", "number_of_needs", "site_duration_score")
                           ,as.character)



####### District level data  ####### 
data_merge_ditrict <- data %>%
  group_by(localisation_district_label) %>%  summarize( 
    cccm_populationestimates_families = weighted_sum(x = cccm_populationestimates_families,df = .,group = !!get_group(.)),
    cccm_populationestimates_individuals = weighted_sum(x = cccm_populationestimates_individuals,df = .,group = !!get_group(.)),
    cccm_idps_arrived = weighted_mean(x = cccm_idps_arrived,df = .,digits = 2,group = !!get_group(.)),
    cccm_idps_departed = weighted_mean(x = cccm_idps_departed,df = .,digits = 2,group = !!get_group(.)),
    cccm_idps_origin_first_top_1_name = select_percents(cccm_idps_origin_first, 1, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_1_pct = select_percents(cccm_idps_origin_first, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_idps_origin_first_top_2_name = select_percents(cccm_idps_origin_first, 2, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_2_pct = select_percents(cccm_idps_origin_first, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_idps_origin_first_top_3_name = select_percents(cccm_idps_origin_first, 3, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_3_pct = select_percents(cccm_idps_origin_first, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_idps_origin_first_top_4_name = select_percents(cccm_idps_origin_first, 4, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_4_pct = select_percents(cccm_idps_origin_first, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_1_name = select_percents(cccm_district_origin_first, 1, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_1_pct = select_percents(cccm_district_origin_first, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_2_name = select_percents(cccm_district_origin_first, 2, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_2_pct = select_percents(cccm_district_origin_first, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_3_name = select_percents(cccm_district_origin_first, 3, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_3_pct = select_percents(cccm_district_origin_first, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_4_name = select_percents(cccm_district_origin_first, 4, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_4_pct = select_percents(cccm_district_origin_first, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_1_name = select_percents(reason_displacement, 1, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_1_pct = select_percents(reason_displacement, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_2_name = select_percents(reason_displacement, 2, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_2_pct = select_percents(reason_displacement, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_3_name = select_percents(reason_displacement, 3, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_3_pct = select_percents(reason_displacement, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_4_name = select_percents(reason_displacement, 4, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_4_pct = select_percents(reason_displacement, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_management_local_authority = percent_response(cccm_management, .,'local_authority', group = !!get_group(.)),
    cccm_management_un_agency = percent_response(cccm_management, .,'un_agency', group = !!get_group(.)),
    cccm_management_local_ngo = percent_response(cccm_management, .,'local_ngo', group = !!get_group(.)),
    cccm_management_ingo = percent_response(cccm_management, .,'ingo', group = !!get_group(.)),
    cccm_management_residents = percent_response(cccm_management, .,'residents', group = !!get_group(.)),
    cccm_management_comm_leader = percent_response(cccm_management, .,'comm_leader', group = !!get_group(.)),
    cccm_management_gatekeeper = percent_response(cccm_management, .,'gatekeeper', group = !!get_group(.)),
    cccm_management_local_comm = percent_response(cccm_management, .,'local_comm', group = !!get_group(.)),
    cccm_management_no_management = percent_response(cccm_management, .,'no_management', group = !!get_group(.)),
    cccm_management_other = percent_response(cccm_management, .,'other', group = !!get_group(.)),
    cccm_management_dnk = percent_response(cccm_management, .,'dnk', group = !!get_group(.)),
    cccm_committees_residents_committee = percent_response(cccm_committees, .,'residents_committee', group = !!get_group(.)),
    cccm_committees_camp_mgmt_committee = percent_response(cccm_committees, .,'camp_mgmt_committee', group = !!get_group(.)),
    cccm_committees_women_committee = percent_response(cccm_committees, .,'women_committee', group = !!get_group(.)),
    cccm_committees_elder = percent_response(cccm_committees, .,'elder', group = !!get_group(.)),
    cccm_committees_wash_committee = percent_response(cccm_committees, .,'wash_committee', group = !!get_group(.)),
    cccm_committees_health_committee = percent_response(cccm_committees, .,'health_committee', group = !!get_group(.)),
    cccm_committees_edu_committee = percent_response(cccm_committees, .,'edu_committee', group = !!get_group(.)),
    cccm_committees_food_committee = percent_response(cccm_committees, .,'food_committee', group = !!get_group(.)),
    cccm_committees_youth_commitee = percent_response(cccm_committees, .,'youth_commitee', group = !!get_group(.)),
    cccm_committees_no_committees = percent_response(cccm_committees, .,'no_committees', group = !!get_group(.)),
    cccm_committees_dnk = percent_response(cccm_committees, .,'dnk', group = !!get_group(.)),
    cccm_committees_other = percent_response(cccm_committees, .,'other', group = !!get_group(.)),
    decision_making_committees_women = percent_response(decision_making_committees, .,'women', group = !!get_group(.)),
    decision_making_committees_minority_clan_members = percent_response(decision_making_committees, .,'minority_clan_members', group = !!get_group(.)),
    decision_making_committees_marginalised_clan_members = percent_response(decision_making_committees, .,'marginalised_clan_members', group = !!get_group(.)),
    decision_making_committees_pwd = percent_response(decision_making_committees, .,'pwd', group = !!get_group(.)),
    decision_making_committees_young_men = percent_response(decision_making_committees, .,'young_men', group = !!get_group(.)),
    decision_making_committees_young_women = percent_response(decision_making_committees, .,'young_women', group = !!get_group(.)),
    decision_making_committees_none_of_the_above = percent_response(decision_making_committees, .,'none_of_the_above', group = !!get_group(.)),
    foodsecurity_access_yes = percent_response(foodsecurity_access, .,'yes', group = !!get_group(.)),
    foodsecurity_access_no = percent_response(foodsecurity_access, .,'no', group = !!get_group(.)),
    foodsecurity_access_dnk = percent_response(foodsecurity_access, .,'dnk', group = !!get_group(.)),
    foodsecurity_access_distance_min_less_15 = percent_response(foodsecurity_access_distance_min, .,'less_15', group = !!get_group(.)),
    foodsecurity_access_distance_min_15_30 = percent_response(foodsecurity_access_distance_min, .,'15_30', group = !!get_group(.)),
    foodsecurity_access_distance_min_31_60 = percent_response(foodsecurity_access_distance_min, .,'31_60', group = !!get_group(.)),
    foodsecurity_access_distance_min_more_60 = percent_response(foodsecurity_access_distance_min, .,'more_60', group = !!get_group(.)),
    foodsecurity_access_distance_min_dnk = percent_response(foodsecurity_access_distance_min, .,'dnk', group = !!get_group(.)),
    foodsecurity_primary_top_1_name = select_percents(foodsecurity_primary, 1, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_1_pct = select_percents(foodsecurity_primary, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_primary_top_2_name = select_percents(foodsecurity_primary, 2, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_2_pct = select_percents(foodsecurity_primary, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_primary_top_3_name = select_percents(foodsecurity_primary, 3, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_3_pct = select_percents(foodsecurity_primary, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_primary_top_4_name = select_percents(foodsecurity_primary, 4, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_4_pct = select_percents(foodsecurity_primary, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_1_name = select_percents(foodsecurity_coping_food, 1, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_1_pct = select_percents(foodsecurity_coping_food, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_2_name = select_percents(foodsecurity_coping_food, 2, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_2_pct = select_percents(foodsecurity_coping_food, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_3_name = select_percents(foodsecurity_coping_food, 3, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_3_pct = select_percents(foodsecurity_coping_food, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_4_name = select_percents(foodsecurity_coping_food, 4, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_4_pct = select_percents(foodsecurity_coping_food, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_1_name = select_percents(foodsecurity_access_barriers, 1, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_1_pct = select_percents(foodsecurity_access_barriers, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_2_name = select_percents(foodsecurity_access_barriers, 2, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_2_pct = select_percents(foodsecurity_access_barriers, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_3_name = select_percents(foodsecurity_access_barriers, 3, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_3_pct = select_percents(foodsecurity_access_barriers, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_4_name = select_percents(foodsecurity_access_barriers, 4, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_4_pct = select_percents(foodsecurity_access_barriers, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    nutrition_access_distance_min_less_15 = percent_response(nutrition_access_distance_min, .,'less_15', group = !!get_group(.)),
    nutrition_access_distance_min_15_30 = percent_response(nutrition_access_distance_min, .,'15_30', group = !!get_group(.)),
    nutrition_access_distance_min_31_60 = percent_response(nutrition_access_distance_min, .,'31_60', group = !!get_group(.)),
    nutrition_access_distance_min_more_60 = percent_response(nutrition_access_distance_min, .,'more_60', group = !!get_group(.)),
    nutrition_access_distance_min_dnk = percent_response(nutrition_access_distance_min, .,'dnk', group = !!get_group(.)),
    nutrition_distributions_muac_tape = percent_response(nutrition_distributions, .,'muac_tape', group = !!get_group(.)),
    nutrition_distributions_plumpy = percent_response(nutrition_distributions, .,'plumpy', group = !!get_group(.)),
    nutrition_distributions_super_cereal_plus = percent_response(nutrition_distributions, .,'super_cereal_plus', group = !!get_group(.)),
    nutrition_distributions_therap_dairy = percent_response(nutrition_distributions, .,'therap_dairy', group = !!get_group(.)),
    nutrition_distributions_none = percent_response(nutrition_distributions, .,'none', group = !!get_group(.)),
    nutrition_distributions_dnk = percent_response(nutrition_distributions, .,'dnk', group = !!get_group(.)),
    nutrition_services_no_problem = percent_response(nutrition_services, .,'no_problem', group = !!get_group(.)),
    nutrition_services_cost = percent_response(nutrition_services, .,'cost', group = !!get_group(.)),
    nutrition_services_no_qualified = percent_response(nutrition_services, .,'no_qualified', group = !!get_group(.)),
    nutrition_services_documents = percent_response(nutrition_services, .,'documents', group = !!get_group(.)),
    nutrition_services_no_referral = percent_response(nutrition_services, .,'no_referral', group = !!get_group(.)),
    nutrition_services_not_open = percent_response(nutrition_services, .,'not_open', group = !!get_group(.)),
    nutrition_services_far_away = percent_response(nutrition_services, .,'far_away', group = !!get_group(.)),
    nutrition_services_refuse_treatment_some_groups = percent_response(nutrition_services, .,'refuse_treatment_some_groups', group = !!get_group(.)),
    nutrition_services_staff_disrespectful = percent_response(nutrition_services, .,'staff_disrespectful', group = !!get_group(.)),
    nutrition_services_refuse_treatment = percent_response(nutrition_services, .,'refuse_treatment', group = !!get_group(.)),
    nutrition_services_no_medicine = percent_response(nutrition_services, .,'no_medicine', group = !!get_group(.)),
    nutrition_services_no_treatment_avail = percent_response(nutrition_services, .,'no_treatment_avail', group = !!get_group(.)),
    nutrition_services_pwd_excluded = percent_response(nutrition_services, .,'pwd_excluded', group = !!get_group(.)),
    nutrition_services_dnk = percent_response(nutrition_services, .,'dnk', group = !!get_group(.)),
    nutrition_services_other = percent_response(nutrition_services, .,'other', group = !!get_group(.)),
    health_access_distance_min_less_15 = percent_response(health_access_distance_min, .,'less_15', group = !!get_group(.)),
    health_access_distance_min_15_30 = percent_response(health_access_distance_min, .,'15_30', group = !!get_group(.)),
    health_access_distance_min_31_60 = percent_response(health_access_distance_min, .,'31_60', group = !!get_group(.)),
    health_access_distance_min_more_60 = percent_response(health_access_distance_min, .,'more_60', group = !!get_group(.)),
    health_access_distance_min_dnk = percent_response(health_access_distance_min, .,'dnk', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_none = percent_response(health_women_unskilledhealthpersonnel, .,'none', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_few = percent_response(health_women_unskilledhealthpersonnel, .,'few', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_some = percent_response(health_women_unskilledhealthpersonnel, .,'some', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_many = percent_response(health_women_unskilledhealthpersonnel, .,'many', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_all = percent_response(health_women_unskilledhealthpersonnel, .,'all', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_dnk = percent_response(health_women_unskilledhealthpersonnel, .,'dnk', group = !!get_group(.)),
    health_services_prim_hc = percent_response(health_services, .,'prim_hc', group = !!get_group(.)),
    health_services_vaccinations = percent_response(health_services, .,'vaccinations', group = !!get_group(.)),
    health_services_child_hc = percent_response(health_services, .,'child_hc', group = !!get_group(.)),
    health_services_maternal_hc = percent_response(health_services, .,'maternal_hc', group = !!get_group(.)),
    health_services_nutrition_services = percent_response(health_services, .,'nutrition_services', group = !!get_group(.)),
    health_services_hiv_counsell_testing = percent_response(health_services, .,'hiv_counsell_testing', group = !!get_group(.)),
    health_services_mental_health_services = percent_response(health_services, .,'mental_health_services', group = !!get_group(.)),
    health_services_sexual_reproductive = percent_response(health_services, .,'sexual_reproductive', group = !!get_group(.)),
    health_services_rehabilitation = percent_response(health_services, .,'rehabilitation', group = !!get_group(.)),
    health_services_none = percent_response(health_services, .,'none', group = !!get_group(.)),
    health_services_dnk = percent_response(health_services, .,'dnk', group = !!get_group(.)),
    health_services_other = percent_response(health_services, .,'other', group = !!get_group(.)),
    health_facilities_first_aid_post = percent_response(health_facilities, .,'first_aid_post', group = !!get_group(.)),
    health_facilities_pharmacy = percent_response(health_facilities, .,'pharmacy', group = !!get_group(.)),
    health_facilities_district_hospital = percent_response(health_facilities, .,'district_hospital', group = !!get_group(.)),
    health_facilities_mobile_clinic = percent_response(health_facilities, .,'mobile_clinic', group = !!get_group(.)),
    health_facilities_private_clinic = percent_response(health_facilities, .,'private_clinic', group = !!get_group(.)),
    health_facilities_ngo_clinic = percent_response(health_facilities, .,'ngo_clinic', group = !!get_group(.)),
    health_facilities_govt_clinic = percent_response(health_facilities, .,'govt_clinic', group = !!get_group(.)),
    health_facilities_no_health_facility = percent_response(health_facilities, .,'no_health_facility', group = !!get_group(.)),
    health_facilities_dnk = percent_response(health_facilities, .,'dnk', group = !!get_group(.)),
    health_facilities_other = percent_response(health_facilities, .,'other', group = !!get_group(.)),
    protection_childfriendlyspace_yes = percent_response(protection_childfriendlyspace, .,'yes', group = !!get_group(.)),
    protection_childfriendlyspace_no = percent_response(protection_childfriendlyspace, .,'no', group = !!get_group(.)),
    protection_childfriendlyspace_dnk = percent_response(protection_childfriendlyspace, .,'dnk', group = !!get_group(.)),
    protection_womenspace_yes = percent_response(protection_womenspace, .,'yes', group = !!get_group(.)),
    protection_womenspace_no = percent_response(protection_womenspace, .,'no', group = !!get_group(.)),
    protection_restrictions_day_yes = percent_response(protection_restrictions_day, .,'yes', group = !!get_group(.)),
    protection_restrictions_day_no = percent_response(protection_restrictions_day, .,'no', group = !!get_group(.)),
    protection_restrictions_day_dnk = percent_response(protection_restrictions_day, .,'dnk', group = !!get_group(.)),
    protection_incidents_illegal_tax = percent_response(protection_incidents, .,'illegal_tax', group = !!get_group(.)),
    protection_incidents_armed_violence = percent_response(protection_incidents, .,'armed_violence', group = !!get_group(.)),
    protection_incidents_uxo = percent_response(protection_incidents, .,'uxo', group = !!get_group(.)),
    protection_incidents_disappear = percent_response(protection_incidents, .,'disappear', group = !!get_group(.)),
    protection_incidents_gbv = percent_response(protection_incidents, .,'gbv', group = !!get_group(.)),
    protection_incidents_arrest_detention = percent_response(protection_incidents, .,'arrest_detention', group = !!get_group(.)),
    protection_incidents_abduction = percent_response(protection_incidents, .,'abduction', group = !!get_group(.)),
    protection_incidents_displacement = percent_response(protection_incidents, .,'displacement', group = !!get_group(.)),
    protection_incidents_forced_recruit = percent_response(protection_incidents, .,'forced_recruit', group = !!get_group(.)),
    protection_incidents_inter_communal = percent_response(protection_incidents, .,'inter_communal', group = !!get_group(.)),
    protection_incidents_violence_aid_distrib = percent_response(protection_incidents, .,'violence_aid_distrib', group = !!get_group(.)),
    protection_incidents_exploit_abuse_access_aid = percent_response(protection_incidents, .,'exploit_abuse_access_aid', group = !!get_group(.)),
    protection_incidents_unaccomp_child = percent_response(protection_incidents, .,'unaccomp_child', group = !!get_group(.)),
    protection_incidents_land_grabbing = percent_response(protection_incidents, .,'land_grabbing', group = !!get_group(.)),
    protection_incidents_destruction_property = percent_response(protection_incidents, .,'destruction_property', group = !!get_group(.)),
    protection_incidents_denied_access_justice = percent_response(protection_incidents, .,'denied_access_justice', group = !!get_group(.)),
    protection_incidents_dnk = percent_response(protection_incidents, .,'dnk', group = !!get_group(.)),
    protection_incidents_pnta = percent_response(protection_incidents, .,'pnta', group = !!get_group(.)),
    protection_incidents_no_incidents = percent_response(protection_incidents, .,'no_incidents', group = !!get_group(.)),
    protection_incidents_other = percent_response(protection_incidents, .,'other', group = !!get_group(.)),
    insecure_areas_no_problems = percent_response(insecure_areas, .,'no_problems', group = !!get_group(.)),
    insecure_areas_in_shelter = percent_response(insecure_areas, .,'in_shelter', group = !!get_group(.)),
    insecure_areas_outside_settlement = percent_response(insecure_areas, .,'outside_settlement', group = !!get_group(.)),
    insecure_areas_markets = percent_response(insecure_areas, .,'markets', group = !!get_group(.)),
    insecure_areas_way_to_market = percent_response(insecure_areas, .,'way_to_market', group = !!get_group(.)),
    insecure_areas_water_point = percent_response(insecure_areas, .,'water_point', group = !!get_group(.)),
    insecure_areas_latrines = percent_response(insecure_areas, .,'latrines', group = !!get_group(.)),
    insecure_areas_bathing_areas = percent_response(insecure_areas, .,'bathing_areas', group = !!get_group(.)),
    insecure_areas_schools = percent_response(insecure_areas, .,'schools', group = !!get_group(.)),
    insecure_areas_way_to_school = percent_response(insecure_areas, .,'way_to_school', group = !!get_group(.)),
    insecure_areas_health_centres = percent_response(insecure_areas, .,'health_centres', group = !!get_group(.)),
    insecure_areas_nutrition_centres = percent_response(insecure_areas, .,'nutrition_centres', group = !!get_group(.)),
    insecure_areas_humanitarian_aid = percent_response(insecure_areas, .,'humanitarian_aid', group = !!get_group(.)),
    insecure_areas_dnk = percent_response(insecure_areas, .,'dnk', group = !!get_group(.)),
    insecure_areas_pnta = percent_response(insecure_areas, .,'pnta', group = !!get_group(.)),
    insecure_areas_other = percent_response(insecure_areas, .,'other', group = !!get_group(.)),
    support_access_impediments_women = percent_response(support_access_impediments, .,'women', group = !!get_group(.)),
    support_access_impediments_children = percent_response(support_access_impediments, .,'children', group = !!get_group(.)),
    support_access_impediments_elders = percent_response(support_access_impediments, .,'elders', group = !!get_group(.)),
    support_access_impediments_disabled = percent_response(support_access_impediments, .,'disabled', group = !!get_group(.)),
    support_access_impediments_minorities = percent_response(support_access_impediments, .,'minorities', group = !!get_group(.)),
    support_access_impediments_marginalised = percent_response(support_access_impediments, .,'marginalised', group = !!get_group(.)),
    support_access_impediments_no_impediments = percent_response(support_access_impediments, .,'no_impediments', group = !!get_group(.)),
    support_access_impediments_dnk = percent_response(support_access_impediments, .,'dnk', group = !!get_group(.)),
    support_access_impediments_other = percent_response(support_access_impediments, .,'other', group = !!get_group(.)),
    housing_property_incidences_confiscation_property = percent_response(housing_property_incidences, .,'confiscation_property', group = !!get_group(.)),
    housing_property_incidences_illegal_occupation = percent_response(housing_property_incidences, .,'illegal_occupation', group = !!get_group(.)),
    housing_property_incidences_encroachment_boundary_disputes = percent_response(housing_property_incidences, .,'encroachment_boundary_disputes', group = !!get_group(.)),
    housing_property_incidences_damaged_inadequate_accomodation = percent_response(housing_property_incidences, .,'damaged_inadequate_accomodation', group = !!get_group(.)),
    housing_property_incidences_dnk = percent_response(housing_property_incidences, .,'dnk', group = !!get_group(.)),
    rate_likelihood_eviction_very_high = percent_response(rate_likelihood_eviction, .,'very_high', group = !!get_group(.)),
    rate_likelihood_eviction_moderate_moderate = percent_response(rate_likelihood_eviction, .,'moderate_moderate', group = !!get_group(.)),
    rate_likelihood_eviction_low = percent_response(rate_likelihood_eviction, .,'low', group = !!get_group(.)),
    rate_likelihood_eviction_pnta = percent_response(rate_likelihood_eviction, .,'pnta', group = !!get_group(.)),
    evictions_landowner_private_owner = percent_response(evictions_landowner, .,'private_owner', group = !!get_group(.)),
    evictions_landowner_local_authority_govt = percent_response(evictions_landowner, .,'local_authority_govt', group = !!get_group(.)),
    evictions_landowner_fed_govt = percent_response(evictions_landowner, .,'fed_govt', group = !!get_group(.)),
    evictions_landowner_mixed = percent_response(evictions_landowner, .,'mixed', group = !!get_group(.)),
    evictions_landowner_no_owner = percent_response(evictions_landowner, .,'no_owner', group = !!get_group(.)),
    evictions_landowner_dnk = percent_response(evictions_landowner, .,'dnk', group = !!get_group(.)),
    evictions_landowner_other = percent_response(evictions_landowner, .,'other', group = !!get_group(.)),
    evictions_landowner_pnta = percent_response(evictions_landowner, .,'pnta', group = !!get_group(.)),
    hlp_nc_index2_0 = percent_response(hlp_nc_index2, .,'0', group = !!get_group(.)),
    hlp_nc_index2_1 = percent_response(hlp_nc_index2, .,'1', group = !!get_group(.)),
    nfi_nc_index3_0 = percent_response(nfi_nc_index3, .,'0', group = !!get_group(.)),
    nfi_nc_index3_1 = percent_response(nfi_nc_index3, .,'1', group = !!get_group(.)),
    shelter_types_top_1_name = select_percents(shelter_types, 1, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_1_pct = select_percents(shelter_types, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    shelter_types_top_2_name = select_percents(shelter_types, 2, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_2_pct = select_percents(shelter_types, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    shelter_types_top_3_name = select_percents(shelter_types, 3, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_3_pct = select_percents(shelter_types, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    shelter_types_top_4_name = select_percents(shelter_types, 4, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_4_pct = select_percents(shelter_types, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_nc_index1_0 = percent_response(nfi_nc_index1, .,'0', group = !!get_group(.)),
    nfi_nc_index1_1 = percent_response(nfi_nc_index1, .,'1', group = !!get_group(.)),
    nfi_items_available_top_1_name = select_percents(nfi_items_available, 1, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_1_pct = select_percents(nfi_items_available, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_items_available_top_2_name = select_percents(nfi_items_available, 2, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_2_pct = select_percents(nfi_items_available, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_items_available_top_3_name = select_percents(nfi_items_available, 3, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_3_pct = select_percents(nfi_items_available, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_items_available_top_4_name = select_percents(nfi_items_available, 4, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_4_pct = select_percents(nfi_items_available, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_nc_index4_0 = percent_response(nfi_nc_index4, .,'0', group = !!get_group(.)),
    nfi_nc_index4_1 = percent_response(nfi_nc_index4, .,'1', group = !!get_group(.)),
    water_access_distance_min_less_15 = percent_response(water_access_distance_min, .,'less_15', group = !!get_group(.)),
    water_access_distance_min_15_30 = percent_response(water_access_distance_min, .,'15_30', group = !!get_group(.)),
    water_access_distance_min_31_60 = percent_response(water_access_distance_min, .,'31_60', group = !!get_group(.)),
    water_access_distance_min_more_60 = percent_response(water_access_distance_min, .,'more_60', group = !!get_group(.)),
    water_access_distance_min_dnk = percent_response(water_access_distance_min, .,'dnk', group = !!get_group(.)),
    water_sources_primary_top_1_name = select_percents(water_sources_primary, 1, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_1_pct = select_percents(water_sources_primary, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    water_sources_primary_top_2_name = select_percents(water_sources_primary, 2, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_2_pct = select_percents(water_sources_primary, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    water_sources_primary_top_3_name = select_percents(water_sources_primary, 3, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_3_pct = select_percents(water_sources_primary, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    water_sources_primary_top_4_name = select_percents(water_sources_primary, 4, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_4_pct = select_percents(water_sources_primary, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    wash_nc_index3_0 = percent_response(wash_nc_index3, .,'0', group = !!get_group(.)),
    wash_nc_index3_1 = percent_response(wash_nc_index3, .,'1', group = !!get_group(.)),
    water_access_barriers_top_1_name = select_percents(water_access_barriers, 1, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_1_pct = select_percents(water_access_barriers, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    water_access_barriers_top_2_name = select_percents(water_access_barriers, 2, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_2_pct = select_percents(water_access_barriers, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    water_access_barriers_top_3_name = select_percents(water_access_barriers, 3, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_3_pct = select_percents(water_access_barriers, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    water_access_barriers_top_4_name = select_percents(water_access_barriers, 4, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_4_pct = select_percents(water_access_barriers, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_distance_min_less_15 = percent_response(sanitation_access_distance_min, .,'less_15', group = !!get_group(.)),
    sanitation_access_distance_min_15_30 = percent_response(sanitation_access_distance_min, .,'15_30', group = !!get_group(.)),
    sanitation_access_distance_min_31_60 = percent_response(sanitation_access_distance_min, .,'31_60', group = !!get_group(.)),
    sanitation_access_distance_min_more_60 = percent_response(sanitation_access_distance_min, .,'more_60', group = !!get_group(.)),
    sanitation_access_distance_min_dnk = percent_response(sanitation_access_distance_min, .,'dnk', group = !!get_group(.)),
    latrines_accessible_pwd_none = percent_response(latrines_accessible_pwd, .,'none', group = !!get_group(.)),
    latrines_accessible_pwd_few = percent_response(latrines_accessible_pwd, .,'few', group = !!get_group(.)),
    latrines_accessible_pwd_some = percent_response(latrines_accessible_pwd, .,'some', group = !!get_group(.)),
    latrines_accessible_pwd_many = percent_response(latrines_accessible_pwd, .,'many', group = !!get_group(.)),
    latrines_accessible_pwd_all = percent_response(latrines_accessible_pwd, .,'all', group = !!get_group(.)),
    latrines_accessible_pwd_dnk = percent_response(latrines_accessible_pwd, .,'dnk', group = !!get_group(.)),
    sanitation_solidwastedisposal_buried_in_pit = percent_response(sanitation_solidwastedisposal, .,'buried_in_pit', group = !!get_group(.)),
    sanitation_solidwastedisposal_disposed_open_grounds = percent_response(sanitation_solidwastedisposal, .,'disposed_open_grounds', group = !!get_group(.)),
    sanitation_solidwastedisposal_burnt_open_spaces = percent_response(sanitation_solidwastedisposal, .,'burnt_open_spaces', group = !!get_group(.)),
    sanitation_solidwastedisposal_not_managed = percent_response(sanitation_solidwastedisposal, .,'not_managed', group = !!get_group(.)),
    sanitation_solidwastedisposal_dnk = percent_response(sanitation_solidwastedisposal, .,'dnk', group = !!get_group(.)),
    sanitation_solidwastedisposal_other = percent_response(sanitation_solidwastedisposal, .,'other', group = !!get_group(.)),
    sanitation_access_impediments_top_1_name = select_percents(sanitation_access_impediments, 1, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_1_pct = select_percents(sanitation_access_impediments, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_impediments_top_2_name = select_percents(sanitation_access_impediments, 2, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_2_pct = select_percents(sanitation_access_impediments, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_impediments_top_3_name = select_percents(sanitation_access_impediments, 3, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_3_pct = select_percents(sanitation_access_impediments, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_impediments_top_4_name = select_percents(sanitation_access_impediments, 4, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_4_pct = select_percents(sanitation_access_impediments, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    hygiene_handwashingfacilities_none = percent_response(hygiene_handwashingfacilities, .,'none', group = !!get_group(.)),
    hygiene_handwashingfacilities_few = percent_response(hygiene_handwashingfacilities, .,'few', group = !!get_group(.)),
    hygiene_handwashingfacilities_some = percent_response(hygiene_handwashingfacilities, .,'some', group = !!get_group(.)),
    hygiene_handwashingfacilities_many = percent_response(hygiene_handwashingfacilities, .,'many', group = !!get_group(.)),
    hygiene_handwashingfacilities_all = percent_response(hygiene_handwashingfacilities, .,'all', group = !!get_group(.)),
    hygiene_handwashingfacilities_dnk = percent_response(hygiene_handwashingfacilities, .,'dnk', group = !!get_group(.)),
    education_access_distance_min_less_15 = percent_response(education_access_distance_min, .,'less_15', group = !!get_group(.)),
    education_access_distance_min_15_30 = percent_response(education_access_distance_min, .,'15_30', group = !!get_group(.)),
    education_access_distance_min_31_60 = percent_response(education_access_distance_min, .,'31_60', group = !!get_group(.)),
    education_access_distance_min_more_60 = percent_response(education_access_distance_min, .,'more_60', group = !!get_group(.)),
    education_access_distance_min_dnk = percent_response(education_access_distance_min, .,'dnk', group = !!get_group(.)),
    education_facilities_primary = percent_response(education_facilities, .,'primary', group = !!get_group(.)),
    education_facilities_secondary = percent_response(education_facilities, .,'secondary', group = !!get_group(.)),
    education_facilities_quoranic = percent_response(education_facilities, .,'quoranic', group = !!get_group(.)),
    education_facilities_basic_edu = percent_response(education_facilities, .,'basic_edu', group = !!get_group(.)),
    education_facilities_no_available = percent_response(education_facilities, .,'no_available', group = !!get_group(.)),
    education_facilities_dnk = percent_response(education_facilities, .,'dnk', group = !!get_group(.)),
    education_facilities_other = percent_response(education_facilities, .,'other', group = !!get_group(.)),
    education_barriers_girls_top_1_name = select_percents(education_barriers_girls, 1, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_1_pct = select_percents(education_barriers_girls, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_girls_top_2_name = select_percents(education_barriers_girls, 2, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_2_pct = select_percents(education_barriers_girls, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_girls_top_3_name = select_percents(education_barriers_girls, 3, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_3_pct = select_percents(education_barriers_girls, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_girls_top_4_name = select_percents(education_barriers_girls, 4, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_4_pct = select_percents(education_barriers_girls, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_1_name = select_percents(education_barriers_boys, 1, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_1_pct = select_percents(education_barriers_boys, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_2_name = select_percents(education_barriers_boys, 2, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_2_pct = select_percents(education_barriers_boys, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_3_name = select_percents(education_barriers_boys, 3, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_3_pct = select_percents(education_barriers_boys, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_4_name = select_percents(education_barriers_boys, 4, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_4_pct = select_percents(education_barriers_boys, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_1_name = select_percents(aap_informationsources, 1, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_1_pct = select_percents(aap_informationsources, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_2_name = select_percents(aap_informationsources, 2, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_2_pct = select_percents(aap_informationsources, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_3_name = select_percents(aap_informationsources, 3, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_3_pct = select_percents(aap_informationsources, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_4_name = select_percents(aap_informationsources, 4, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_4_pct = select_percents(aap_informationsources, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_1_name = select_percents(aap_informationsources_pwd, 1, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_1_pct = select_percents(aap_informationsources_pwd, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_2_name = select_percents(aap_informationsources_pwd, 2, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_2_pct = select_percents(aap_informationsources_pwd, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_3_name = select_percents(aap_informationsources_pwd, 3, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_3_pct = select_percents(aap_informationsources_pwd, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_4_name = select_percents(aap_informationsources_pwd, 4, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_4_pct = select_percents(aap_informationsources_pwd, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_1_name = select_percents(aap_access_barriers, 1, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_1_pct = select_percents(aap_access_barriers, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_2_name = select_percents(aap_access_barriers, 2, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_2_pct = select_percents(aap_access_barriers, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_3_name = select_percents(aap_access_barriers, 3, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_3_pct = select_percents(aap_access_barriers, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_4_name = select_percents(aap_access_barriers, 4, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_4_pct = select_percents(aap_access_barriers, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_feedbackmechanism_yes = percent_response(aap_feedbackmechanism, .,'yes', group = !!get_group(.)),
    aap_feedbackmechanism_no = percent_response(aap_feedbackmechanism, .,'no', group = !!get_group(.)),
    aap_feedbackmechanism_dnk = percent_response(aap_feedbackmechanism, .,'dnk', group = !!get_group(.)),
    covid_issue_yes = percent_response(covid_issue, .,'yes', group = !!get_group(.)),
    covid_issue_no = percent_response(covid_issue, .,'no', group = !!get_group(.)),
    covid_issue_dnk = percent_response(covid_issue, .,'dnk', group = !!get_group(.)),
    action_to_prevent_no_action = percent_response(action_to_prevent, .,'no_action', group = !!get_group(.)),
    action_to_prevent_not_all = percent_response(action_to_prevent, .,'not_all', group = !!get_group(.)),
    action_to_prevent_reducing_house = percent_response(action_to_prevent, .,'reducing_house', group = !!get_group(.)),
    action_to_prevent_stopping_contact = percent_response(action_to_prevent, .,'stopping_contact', group = !!get_group(.)),
    action_to_prevent_keeping_people = percent_response(action_to_prevent, .,'keeping_people', group = !!get_group(.)),
    action_to_prevent_avoiding_gatherings = percent_response(action_to_prevent, .,'avoiding_gatherings', group = !!get_group(.)),
    action_to_prevent_avoiding_transport = percent_response(action_to_prevent, .,'avoiding_transport', group = !!get_group(.)),
    action_to_prevent_wearing_mask = percent_response(action_to_prevent, .,'wearing_mask', group = !!get_group(.)),
    action_to_prevent_wearing_gloves = percent_response(action_to_prevent, .,'wearing_gloves', group = !!get_group(.)),
    action_to_prevent_washing_regularly = percent_response(action_to_prevent, .,'washing_regularly', group = !!get_group(.)),
    action_to_prevent_keeping_clean = percent_response(action_to_prevent, .,'keeping_clean', group = !!get_group(.)),
    action_to_prevent_praying_god = percent_response(action_to_prevent, .,'praying_god', group = !!get_group(.)),
    action_to_prevent_staying_animals = percent_response(action_to_prevent, .,'staying_animals', group = !!get_group(.)),
    action_to_prevent_other = percent_response(action_to_prevent, .,'other', group = !!get_group(.)),
    action_to_prevent_dnk = percent_response(action_to_prevent, .,'dnk', group = !!get_group(.)),
    snfi_score_1 = percent_response(snfi_score, .,'1', group = !!get_group(.)),
    snfi_score_2 = percent_response(snfi_score, .,'2', group = !!get_group(.)),
    snfi_score_3 = percent_response(snfi_score, .,'3', group = !!get_group(.)),
    snfi_score_4 = 0,
    wash_score_1 = percent_response(wash_score, .,'1', group = !!get_group(.)),
    wash_score_2 = percent_response(wash_score, .,'2', group = !!get_group(.)),
    wash_score_3 = percent_response(wash_score, .,'3', group = !!get_group(.)),
    wash_score_4 = percent_response(wash_score, .,'4', group = !!get_group(.)),
    protection_score_1 = percent_response(protection_score, .,'1', group = !!get_group(.)),
    protection_score_2 = percent_response(protection_score, .,'2', group = !!get_group(.)),
    protection_score_3 = percent_response(protection_score, .,'3', group = !!get_group(.)),
    protection_score_4 = percent_response(protection_score, .,'4', group = !!get_group(.)),
    fs_score_1 = percent_response(fs_score, .,'1', group = !!get_group(.)),
    fs_score_2 = percent_response(fs_score, .,'2', group = !!get_group(.)),
    fs_score_3 = percent_response(fs_score, .,'3', group = !!get_group(.)),
    fs_score_4 = percent_response(fs_score, .,'4', group = !!get_group(.)),
    health_score_1 = percent_response(health_score, .,'1', group = !!get_group(.)),
    health_score_2 = percent_response(health_score, .,'2', group = !!get_group(.)),
    health_score_3 = percent_response(health_score, .,'3', group = !!get_group(.)),
    health_score_4 = percent_response(health_score, .,'4', group = !!get_group(.)),
    nutrition_score_1 = percent_response(nutrition_score, .,'1', group = !!get_group(.)),
    nutrition_score_2 = percent_response(nutrition_score, .,'2', group = !!get_group(.)),
    nutrition_score_3 = percent_response(nutrition_score, .,'3', group = !!get_group(.)),
    nutrition_score_4 = 0,
    education_score_1 = percent_response(education_score, .,'1', group = !!get_group(.)),
    education_score_2 = percent_response(education_score, .,'2', group = !!get_group(.)),
    education_score_3 = percent_response(education_score, .,'3', group = !!get_group(.)),
    education_score_4 = percent_response(education_score, .,'4', group = !!get_group(.)),
    hlp_score_1 = percent_response(hlp_score, .,'1', group = !!get_group(.)),
    hlp_score_2 = percent_response(hlp_score, .,'2', group = !!get_group(.)),
    hlp_score_3 = percent_response(hlp_score, .,'3', group = !!get_group(.)),
    hlp_score_4 = percent_response(hlp_score, .,'4', group = !!get_group(.)),
    n_surveys = n()
  )
####### National level data ####### 
data_merge_national <- data %>%
  group_by(localisation_region_label) %>%  summarize( 
    cccm_populationestimates_families = weighted_sum(x = cccm_populationestimates_families,df = .,group = !!get_group(.)),
    cccm_populationestimates_individuals = weighted_sum(x = cccm_populationestimates_individuals,df = .,group = !!get_group(.)),
    cccm_idps_arrived = weighted_mean(x = cccm_idps_arrived,df = .,digits = 2,group = !!get_group(.)),
    cccm_idps_departed = weighted_mean(x = cccm_idps_departed,df = .,digits = 2,group = !!get_group(.)),
    cccm_idps_origin_first_top_1_name = select_percents(cccm_idps_origin_first, 1, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_1_pct = select_percents(cccm_idps_origin_first, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_idps_origin_first_top_2_name = select_percents(cccm_idps_origin_first, 2, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_2_pct = select_percents(cccm_idps_origin_first, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_idps_origin_first_top_3_name = select_percents(cccm_idps_origin_first, 3, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_3_pct = select_percents(cccm_idps_origin_first, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_idps_origin_first_top_4_name = select_percents(cccm_idps_origin_first, 4, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_idps_origin_first_top_4_pct = select_percents(cccm_idps_origin_first, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_1_name = select_percents(cccm_district_origin_first, 1, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_1_pct = select_percents(cccm_district_origin_first, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_2_name = select_percents(cccm_district_origin_first, 2, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_2_pct = select_percents(cccm_district_origin_first, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_3_name = select_percents(cccm_district_origin_first, 3, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_3_pct = select_percents(cccm_district_origin_first, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_district_origin_first_top_4_name = select_percents(cccm_district_origin_first, 4, ., questions, choices, 'label', group = !!get_group(.)),
    cccm_district_origin_first_top_4_pct = select_percents(cccm_district_origin_first, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_1_name = select_percents(reason_displacement, 1, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_1_pct = select_percents(reason_displacement, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_2_name = select_percents(reason_displacement, 2, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_2_pct = select_percents(reason_displacement, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_3_name = select_percents(reason_displacement, 3, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_3_pct = select_percents(reason_displacement, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    reason_displacement_top_4_name = select_percents(reason_displacement, 4, ., questions, choices, 'label', group = !!get_group(.)),
    reason_displacement_top_4_pct = select_percents(reason_displacement, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    cccm_management_local_authority = percent_response(cccm_management, .,'local_authority', group = !!get_group(.)),
    cccm_management_un_agency = percent_response(cccm_management, .,'un_agency', group = !!get_group(.)),
    cccm_management_local_ngo = percent_response(cccm_management, .,'local_ngo', group = !!get_group(.)),
    cccm_management_ingo = percent_response(cccm_management, .,'ingo', group = !!get_group(.)),
    cccm_management_residents = percent_response(cccm_management, .,'residents', group = !!get_group(.)),
    cccm_management_comm_leader = percent_response(cccm_management, .,'comm_leader', group = !!get_group(.)),
    cccm_management_gatekeeper = percent_response(cccm_management, .,'gatekeeper', group = !!get_group(.)),
    cccm_management_local_comm = percent_response(cccm_management, .,'local_comm', group = !!get_group(.)),
    cccm_management_no_management = percent_response(cccm_management, .,'no_management', group = !!get_group(.)),
    cccm_management_other = percent_response(cccm_management, .,'other', group = !!get_group(.)),
    cccm_management_dnk = percent_response(cccm_management, .,'dnk', group = !!get_group(.)),
    cccm_committees_residents_committee = percent_response(cccm_committees, .,'residents_committee', group = !!get_group(.)),
    cccm_committees_camp_mgmt_committee = percent_response(cccm_committees, .,'camp_mgmt_committee', group = !!get_group(.)),
    cccm_committees_women_committee = percent_response(cccm_committees, .,'women_committee', group = !!get_group(.)),
    cccm_committees_elder = percent_response(cccm_committees, .,'elder', group = !!get_group(.)),
    cccm_committees_wash_committee = percent_response(cccm_committees, .,'wash_committee', group = !!get_group(.)),
    cccm_committees_health_committee = percent_response(cccm_committees, .,'health_committee', group = !!get_group(.)),
    cccm_committees_edu_committee = percent_response(cccm_committees, .,'edu_committee', group = !!get_group(.)),
    cccm_committees_food_committee = percent_response(cccm_committees, .,'food_committee', group = !!get_group(.)),
    cccm_committees_youth_commitee = percent_response(cccm_committees, .,'youth_commitee', group = !!get_group(.)),
    cccm_committees_no_committees = percent_response(cccm_committees, .,'no_committees', group = !!get_group(.)),
    cccm_committees_dnk = percent_response(cccm_committees, .,'dnk', group = !!get_group(.)),
    cccm_committees_other = percent_response(cccm_committees, .,'other', group = !!get_group(.)),
    decision_making_committees_women = percent_response(decision_making_committees, .,'women', group = !!get_group(.)),
    decision_making_committees_minority_clan_members = percent_response(decision_making_committees, .,'minority_clan_members', group = !!get_group(.)),
    decision_making_committees_marginalised_clan_members = percent_response(decision_making_committees, .,'marginalised_clan_members', group = !!get_group(.)),
    decision_making_committees_pwd = percent_response(decision_making_committees, .,'pwd', group = !!get_group(.)),
    decision_making_committees_young_men = percent_response(decision_making_committees, .,'young_men', group = !!get_group(.)),
    decision_making_committees_young_women = percent_response(decision_making_committees, .,'young_women', group = !!get_group(.)),
    decision_making_committees_none_of_the_above = percent_response(decision_making_committees, .,'none_of_the_above', group = !!get_group(.)),
    foodsecurity_access_yes = percent_response(foodsecurity_access, .,'yes', group = !!get_group(.)),
    foodsecurity_access_no = percent_response(foodsecurity_access, .,'no', group = !!get_group(.)),
    foodsecurity_access_dnk = percent_response(foodsecurity_access, .,'dnk', group = !!get_group(.)),
    foodsecurity_access_distance_min_less_15 = percent_response(foodsecurity_access_distance_min, .,'less_15', group = !!get_group(.)),
    foodsecurity_access_distance_min_15_30 = percent_response(foodsecurity_access_distance_min, .,'15_30', group = !!get_group(.)),
    foodsecurity_access_distance_min_31_60 = percent_response(foodsecurity_access_distance_min, .,'31_60', group = !!get_group(.)),
    foodsecurity_access_distance_min_more_60 = percent_response(foodsecurity_access_distance_min, .,'more_60', group = !!get_group(.)),
    foodsecurity_access_distance_min_dnk = percent_response(foodsecurity_access_distance_min, .,'dnk', group = !!get_group(.)),
    foodsecurity_primary_top_1_name = select_percents(foodsecurity_primary, 1, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_1_pct = select_percents(foodsecurity_primary, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_primary_top_2_name = select_percents(foodsecurity_primary, 2, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_2_pct = select_percents(foodsecurity_primary, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_primary_top_3_name = select_percents(foodsecurity_primary, 3, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_3_pct = select_percents(foodsecurity_primary, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_primary_top_4_name = select_percents(foodsecurity_primary, 4, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_primary_top_4_pct = select_percents(foodsecurity_primary, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_1_name = select_percents(foodsecurity_coping_food, 1, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_1_pct = select_percents(foodsecurity_coping_food, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_2_name = select_percents(foodsecurity_coping_food, 2, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_2_pct = select_percents(foodsecurity_coping_food, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_3_name = select_percents(foodsecurity_coping_food, 3, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_3_pct = select_percents(foodsecurity_coping_food, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_coping_food_top_4_name = select_percents(foodsecurity_coping_food, 4, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_coping_food_top_4_pct = select_percents(foodsecurity_coping_food, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_1_name = select_percents(foodsecurity_access_barriers, 1, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_1_pct = select_percents(foodsecurity_access_barriers, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_2_name = select_percents(foodsecurity_access_barriers, 2, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_2_pct = select_percents(foodsecurity_access_barriers, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_3_name = select_percents(foodsecurity_access_barriers, 3, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_3_pct = select_percents(foodsecurity_access_barriers, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    foodsecurity_access_barriers_top_4_name = select_percents(foodsecurity_access_barriers, 4, ., questions, choices, 'label', group = !!get_group(.)),
    foodsecurity_access_barriers_top_4_pct = select_percents(foodsecurity_access_barriers, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    nutrition_access_distance_min_less_15 = percent_response(nutrition_access_distance_min, .,'less_15', group = !!get_group(.)),
    nutrition_access_distance_min_15_30 = percent_response(nutrition_access_distance_min, .,'15_30', group = !!get_group(.)),
    nutrition_access_distance_min_31_60 = percent_response(nutrition_access_distance_min, .,'31_60', group = !!get_group(.)),
    nutrition_access_distance_min_more_60 = percent_response(nutrition_access_distance_min, .,'more_60', group = !!get_group(.)),
    nutrition_access_distance_min_dnk = percent_response(nutrition_access_distance_min, .,'dnk', group = !!get_group(.)),
    nutrition_distributions_muac_tape = percent_response(nutrition_distributions, .,'muac_tape', group = !!get_group(.)),
    nutrition_distributions_plumpy = percent_response(nutrition_distributions, .,'plumpy', group = !!get_group(.)),
    nutrition_distributions_super_cereal_plus = percent_response(nutrition_distributions, .,'super_cereal_plus', group = !!get_group(.)),
    nutrition_distributions_therap_dairy = percent_response(nutrition_distributions, .,'therap_dairy', group = !!get_group(.)),
    nutrition_distributions_none = percent_response(nutrition_distributions, .,'none', group = !!get_group(.)),
    nutrition_distributions_dnk = percent_response(nutrition_distributions, .,'dnk', group = !!get_group(.)),
    nutrition_services_no_problem = percent_response(nutrition_services, .,'no_problem', group = !!get_group(.)),
    nutrition_services_cost = percent_response(nutrition_services, .,'cost', group = !!get_group(.)),
    nutrition_services_no_qualified = percent_response(nutrition_services, .,'no_qualified', group = !!get_group(.)),
    nutrition_services_documents = percent_response(nutrition_services, .,'documents', group = !!get_group(.)),
    nutrition_services_no_referral = percent_response(nutrition_services, .,'no_referral', group = !!get_group(.)),
    nutrition_services_not_open = percent_response(nutrition_services, .,'not_open', group = !!get_group(.)),
    nutrition_services_far_away = percent_response(nutrition_services, .,'far_away', group = !!get_group(.)),
    nutrition_services_refuse_treatment_some_groups = percent_response(nutrition_services, .,'refuse_treatment_some_groups', group = !!get_group(.)),
    nutrition_services_staff_disrespectful = percent_response(nutrition_services, .,'staff_disrespectful', group = !!get_group(.)),
    nutrition_services_refuse_treatment = percent_response(nutrition_services, .,'refuse_treatment', group = !!get_group(.)),
    nutrition_services_no_medicine = percent_response(nutrition_services, .,'no_medicine', group = !!get_group(.)),
    nutrition_services_no_treatment_avail = percent_response(nutrition_services, .,'no_treatment_avail', group = !!get_group(.)),
    nutrition_services_pwd_excluded = percent_response(nutrition_services, .,'pwd_excluded', group = !!get_group(.)),
    nutrition_services_dnk = percent_response(nutrition_services, .,'dnk', group = !!get_group(.)),
    nutrition_services_other = percent_response(nutrition_services, .,'other', group = !!get_group(.)),
    health_access_distance_min_less_15 = percent_response(health_access_distance_min, .,'less_15', group = !!get_group(.)),
    health_access_distance_min_15_30 = percent_response(health_access_distance_min, .,'15_30', group = !!get_group(.)),
    health_access_distance_min_31_60 = percent_response(health_access_distance_min, .,'31_60', group = !!get_group(.)),
    health_access_distance_min_more_60 = percent_response(health_access_distance_min, .,'more_60', group = !!get_group(.)),
    health_access_distance_min_dnk = percent_response(health_access_distance_min, .,'dnk', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_none = percent_response(health_women_unskilledhealthpersonnel, .,'none', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_few = percent_response(health_women_unskilledhealthpersonnel, .,'few', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_some = percent_response(health_women_unskilledhealthpersonnel, .,'some', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_many = percent_response(health_women_unskilledhealthpersonnel, .,'many', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_all = percent_response(health_women_unskilledhealthpersonnel, .,'all', group = !!get_group(.)),
    health_women_unskilledhealthpersonnel_dnk = percent_response(health_women_unskilledhealthpersonnel, .,'dnk', group = !!get_group(.)),
    health_services_prim_hc = percent_response(health_services, .,'prim_hc', group = !!get_group(.)),
    health_services_vaccinations = percent_response(health_services, .,'vaccinations', group = !!get_group(.)),
    health_services_child_hc = percent_response(health_services, .,'child_hc', group = !!get_group(.)),
    health_services_maternal_hc = percent_response(health_services, .,'maternal_hc', group = !!get_group(.)),
    health_services_nutrition_services = percent_response(health_services, .,'nutrition_services', group = !!get_group(.)),
    health_services_hiv_counsell_testing = percent_response(health_services, .,'hiv_counsell_testing', group = !!get_group(.)),
    health_services_mental_health_services = percent_response(health_services, .,'mental_health_services', group = !!get_group(.)),
    health_services_sexual_reproductive = percent_response(health_services, .,'sexual_reproductive', group = !!get_group(.)),
    health_services_rehabilitation = percent_response(health_services, .,'rehabilitation', group = !!get_group(.)),
    health_services_none = percent_response(health_services, .,'none', group = !!get_group(.)),
    health_services_dnk = percent_response(health_services, .,'dnk', group = !!get_group(.)),
    health_services_other = percent_response(health_services, .,'other', group = !!get_group(.)),
    health_facilities_first_aid_post = percent_response(health_facilities, .,'first_aid_post', group = !!get_group(.)),
    health_facilities_pharmacy = percent_response(health_facilities, .,'pharmacy', group = !!get_group(.)),
    health_facilities_district_hospital = percent_response(health_facilities, .,'district_hospital', group = !!get_group(.)),
    health_facilities_mobile_clinic = percent_response(health_facilities, .,'mobile_clinic', group = !!get_group(.)),
    health_facilities_private_clinic = percent_response(health_facilities, .,'private_clinic', group = !!get_group(.)),
    health_facilities_ngo_clinic = percent_response(health_facilities, .,'ngo_clinic', group = !!get_group(.)),
    health_facilities_govt_clinic = percent_response(health_facilities, .,'govt_clinic', group = !!get_group(.)),
    health_facilities_no_health_facility = percent_response(health_facilities, .,'no_health_facility', group = !!get_group(.)),
    health_facilities_dnk = percent_response(health_facilities, .,'dnk', group = !!get_group(.)),
    health_facilities_other = percent_response(health_facilities, .,'other', group = !!get_group(.)),
    protection_childfriendlyspace_yes = percent_response(protection_childfriendlyspace, .,'yes', group = !!get_group(.)),
    protection_childfriendlyspace_no = percent_response(protection_childfriendlyspace, .,'no', group = !!get_group(.)),
    protection_childfriendlyspace_dnk = percent_response(protection_childfriendlyspace, .,'dnk', group = !!get_group(.)),
    protection_womenspace_yes = percent_response(protection_womenspace, .,'yes', group = !!get_group(.)),
    protection_womenspace_no = percent_response(protection_womenspace, .,'no', group = !!get_group(.)),
    protection_restrictions_day_yes = percent_response(protection_restrictions_day, .,'yes', group = !!get_group(.)),
    protection_restrictions_day_no = percent_response(protection_restrictions_day, .,'no', group = !!get_group(.)),
    protection_restrictions_day_dnk = percent_response(protection_restrictions_day, .,'dnk', group = !!get_group(.)),
    protection_incidents_illegal_tax = percent_response(protection_incidents, .,'illegal_tax', group = !!get_group(.)),
    protection_incidents_armed_violence = percent_response(protection_incidents, .,'armed_violence', group = !!get_group(.)),
    protection_incidents_uxo = percent_response(protection_incidents, .,'uxo', group = !!get_group(.)),
    protection_incidents_disappear = percent_response(protection_incidents, .,'disappear', group = !!get_group(.)),
    protection_incidents_gbv = percent_response(protection_incidents, .,'gbv', group = !!get_group(.)),
    protection_incidents_arrest_detention = percent_response(protection_incidents, .,'arrest_detention', group = !!get_group(.)),
    protection_incidents_abduction = percent_response(protection_incidents, .,'abduction', group = !!get_group(.)),
    protection_incidents_displacement = percent_response(protection_incidents, .,'displacement', group = !!get_group(.)),
    protection_incidents_forced_recruit = percent_response(protection_incidents, .,'forced_recruit', group = !!get_group(.)),
    protection_incidents_inter_communal = percent_response(protection_incidents, .,'inter_communal', group = !!get_group(.)),
    protection_incidents_violence_aid_distrib = percent_response(protection_incidents, .,'violence_aid_distrib', group = !!get_group(.)),
    protection_incidents_exploit_abuse_access_aid = percent_response(protection_incidents, .,'exploit_abuse_access_aid', group = !!get_group(.)),
    protection_incidents_unaccomp_child = percent_response(protection_incidents, .,'unaccomp_child', group = !!get_group(.)),
    protection_incidents_land_grabbing = percent_response(protection_incidents, .,'land_grabbing', group = !!get_group(.)),
    protection_incidents_destruction_property = percent_response(protection_incidents, .,'destruction_property', group = !!get_group(.)),
    protection_incidents_denied_access_justice = percent_response(protection_incidents, .,'denied_access_justice', group = !!get_group(.)),
    protection_incidents_dnk = percent_response(protection_incidents, .,'dnk', group = !!get_group(.)),
    protection_incidents_pnta = percent_response(protection_incidents, .,'pnta', group = !!get_group(.)),
    protection_incidents_no_incidents = percent_response(protection_incidents, .,'no_incidents', group = !!get_group(.)),
    protection_incidents_other = percent_response(protection_incidents, .,'other', group = !!get_group(.)),
    insecure_areas_no_problems = percent_response(insecure_areas, .,'no_problems', group = !!get_group(.)),
    insecure_areas_in_shelter = percent_response(insecure_areas, .,'in_shelter', group = !!get_group(.)),
    insecure_areas_outside_settlement = percent_response(insecure_areas, .,'outside_settlement', group = !!get_group(.)),
    insecure_areas_markets = percent_response(insecure_areas, .,'markets', group = !!get_group(.)),
    insecure_areas_way_to_market = percent_response(insecure_areas, .,'way_to_market', group = !!get_group(.)),
    insecure_areas_water_point = percent_response(insecure_areas, .,'water_point', group = !!get_group(.)),
    insecure_areas_latrines = percent_response(insecure_areas, .,'latrines', group = !!get_group(.)),
    insecure_areas_bathing_areas = percent_response(insecure_areas, .,'bathing_areas', group = !!get_group(.)),
    insecure_areas_schools = percent_response(insecure_areas, .,'schools', group = !!get_group(.)),
    insecure_areas_way_to_school = percent_response(insecure_areas, .,'way_to_school', group = !!get_group(.)),
    insecure_areas_health_centres = percent_response(insecure_areas, .,'health_centres', group = !!get_group(.)),
    insecure_areas_nutrition_centres = percent_response(insecure_areas, .,'nutrition_centres', group = !!get_group(.)),
    insecure_areas_humanitarian_aid = percent_response(insecure_areas, .,'humanitarian_aid', group = !!get_group(.)),
    insecure_areas_dnk = percent_response(insecure_areas, .,'dnk', group = !!get_group(.)),
    insecure_areas_pnta = percent_response(insecure_areas, .,'pnta', group = !!get_group(.)),
    insecure_areas_other = percent_response(insecure_areas, .,'other', group = !!get_group(.)),
    support_access_impediments_women = percent_response(support_access_impediments, .,'women', group = !!get_group(.)),
    support_access_impediments_children = percent_response(support_access_impediments, .,'children', group = !!get_group(.)),
    support_access_impediments_elders = percent_response(support_access_impediments, .,'elders', group = !!get_group(.)),
    support_access_impediments_disabled = percent_response(support_access_impediments, .,'disabled', group = !!get_group(.)),
    support_access_impediments_minorities = percent_response(support_access_impediments, .,'minorities', group = !!get_group(.)),
    support_access_impediments_marginalised = percent_response(support_access_impediments, .,'marginalised', group = !!get_group(.)),
    support_access_impediments_no_impediments = percent_response(support_access_impediments, .,'no_impediments', group = !!get_group(.)),
    support_access_impediments_dnk = percent_response(support_access_impediments, .,'dnk', group = !!get_group(.)),
    support_access_impediments_other = percent_response(support_access_impediments, .,'other', group = !!get_group(.)),
    housing_property_incidences_confiscation_property = percent_response(housing_property_incidences, .,'confiscation_property', group = !!get_group(.)),
    housing_property_incidences_illegal_occupation = percent_response(housing_property_incidences, .,'illegal_occupation', group = !!get_group(.)),
    housing_property_incidences_encroachment_boundary_disputes = percent_response(housing_property_incidences, .,'encroachment_boundary_disputes', group = !!get_group(.)),
    housing_property_incidences_damaged_inadequate_accomodation = percent_response(housing_property_incidences, .,'damaged_inadequate_accomodation', group = !!get_group(.)),
    housing_property_incidences_dnk = percent_response(housing_property_incidences, .,'dnk', group = !!get_group(.)),
    rate_likelihood_eviction_very_high = percent_response(rate_likelihood_eviction, .,'very_high', group = !!get_group(.)),
    rate_likelihood_eviction_moderate_moderate = percent_response(rate_likelihood_eviction, .,'moderate_moderate', group = !!get_group(.)),
    rate_likelihood_eviction_low = percent_response(rate_likelihood_eviction, .,'low', group = !!get_group(.)),
    rate_likelihood_eviction_pnta = percent_response(rate_likelihood_eviction, .,'pnta', group = !!get_group(.)),
    evictions_landowner_private_owner = percent_response(evictions_landowner, .,'private_owner', group = !!get_group(.)),
    evictions_landowner_local_authority_govt = percent_response(evictions_landowner, .,'local_authority_govt', group = !!get_group(.)),
    evictions_landowner_fed_govt = percent_response(evictions_landowner, .,'fed_govt', group = !!get_group(.)),
    evictions_landowner_mixed = percent_response(evictions_landowner, .,'mixed', group = !!get_group(.)),
    evictions_landowner_no_owner = percent_response(evictions_landowner, .,'no_owner', group = !!get_group(.)),
    evictions_landowner_dnk = percent_response(evictions_landowner, .,'dnk', group = !!get_group(.)),
    evictions_landowner_other = percent_response(evictions_landowner, .,'other', group = !!get_group(.)),
    evictions_landowner_pnta = percent_response(evictions_landowner, .,'pnta', group = !!get_group(.)),
    hlp_nc_index2_0 = percent_response(hlp_nc_index2, .,'0', group = !!get_group(.)),
    hlp_nc_index2_1 = percent_response(hlp_nc_index2, .,'1', group = !!get_group(.)),
    nfi_nc_index3_0 = percent_response(nfi_nc_index3, .,'0', group = !!get_group(.)),
    nfi_nc_index3_1 = percent_response(nfi_nc_index3, .,'1', group = !!get_group(.)),
    shelter_types_top_1_name = select_percents(shelter_types, 1, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_1_pct = select_percents(shelter_types, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    shelter_types_top_2_name = select_percents(shelter_types, 2, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_2_pct = select_percents(shelter_types, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    shelter_types_top_3_name = select_percents(shelter_types, 3, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_3_pct = select_percents(shelter_types, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    shelter_types_top_4_name = select_percents(shelter_types, 4, ., questions, choices, 'label', group = !!get_group(.)),
    shelter_types_top_4_pct = select_percents(shelter_types, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_nc_index1_0 = percent_response(nfi_nc_index1, .,'0', group = !!get_group(.)),
    nfi_nc_index1_1 = percent_response(nfi_nc_index1, .,'1', group = !!get_group(.)),
    nfi_items_available_top_1_name = select_percents(nfi_items_available, 1, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_1_pct = select_percents(nfi_items_available, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_items_available_top_2_name = select_percents(nfi_items_available, 2, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_2_pct = select_percents(nfi_items_available, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_items_available_top_3_name = select_percents(nfi_items_available, 3, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_3_pct = select_percents(nfi_items_available, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_items_available_top_4_name = select_percents(nfi_items_available, 4, ., questions, choices, 'label', group = !!get_group(.)),
    nfi_items_available_top_4_pct = select_percents(nfi_items_available, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    nfi_nc_index4_0 = percent_response(nfi_nc_index4, .,'0', group = !!get_group(.)),
    nfi_nc_index4_1 = percent_response(nfi_nc_index4, .,'1', group = !!get_group(.)),
    water_access_distance_min_less_15 = percent_response(water_access_distance_min, .,'less_15', group = !!get_group(.)),
    water_access_distance_min_15_30 = percent_response(water_access_distance_min, .,'15_30', group = !!get_group(.)),
    water_access_distance_min_31_60 = percent_response(water_access_distance_min, .,'31_60', group = !!get_group(.)),
    water_access_distance_min_more_60 = percent_response(water_access_distance_min, .,'more_60', group = !!get_group(.)),
    water_access_distance_min_dnk = percent_response(water_access_distance_min, .,'dnk', group = !!get_group(.)),
    water_sources_primary_top_1_name = select_percents(water_sources_primary, 1, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_1_pct = select_percents(water_sources_primary, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    water_sources_primary_top_2_name = select_percents(water_sources_primary, 2, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_2_pct = select_percents(water_sources_primary, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    water_sources_primary_top_3_name = select_percents(water_sources_primary, 3, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_3_pct = select_percents(water_sources_primary, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    water_sources_primary_top_4_name = select_percents(water_sources_primary, 4, ., questions, choices, 'label', group = !!get_group(.)),
    water_sources_primary_top_4_pct = select_percents(water_sources_primary, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    wash_nc_index3_0 = percent_response(wash_nc_index3, .,'0', group = !!get_group(.)),
    wash_nc_index3_1 = percent_response(wash_nc_index3, .,'1', group = !!get_group(.)),
    water_access_barriers_top_1_name = select_percents(water_access_barriers, 1, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_1_pct = select_percents(water_access_barriers, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    water_access_barriers_top_2_name = select_percents(water_access_barriers, 2, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_2_pct = select_percents(water_access_barriers, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    water_access_barriers_top_3_name = select_percents(water_access_barriers, 3, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_3_pct = select_percents(water_access_barriers, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    water_access_barriers_top_4_name = select_percents(water_access_barriers, 4, ., questions, choices, 'label', group = !!get_group(.)),
    water_access_barriers_top_4_pct = select_percents(water_access_barriers, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_distance_min_less_15 = percent_response(sanitation_access_distance_min, .,'less_15', group = !!get_group(.)),
    sanitation_access_distance_min_15_30 = percent_response(sanitation_access_distance_min, .,'15_30', group = !!get_group(.)),
    sanitation_access_distance_min_31_60 = percent_response(sanitation_access_distance_min, .,'31_60', group = !!get_group(.)),
    sanitation_access_distance_min_more_60 = percent_response(sanitation_access_distance_min, .,'more_60', group = !!get_group(.)),
    sanitation_access_distance_min_dnk = percent_response(sanitation_access_distance_min, .,'dnk', group = !!get_group(.)),
    latrines_accessible_pwd_none = percent_response(latrines_accessible_pwd, .,'none', group = !!get_group(.)),
    latrines_accessible_pwd_few = percent_response(latrines_accessible_pwd, .,'few', group = !!get_group(.)),
    latrines_accessible_pwd_some = percent_response(latrines_accessible_pwd, .,'some', group = !!get_group(.)),
    latrines_accessible_pwd_many = percent_response(latrines_accessible_pwd, .,'many', group = !!get_group(.)),
    latrines_accessible_pwd_all = percent_response(latrines_accessible_pwd, .,'all', group = !!get_group(.)),
    latrines_accessible_pwd_dnk = percent_response(latrines_accessible_pwd, .,'dnk', group = !!get_group(.)),
    sanitation_solidwastedisposal_buried_in_pit = percent_response(sanitation_solidwastedisposal, .,'buried_in_pit', group = !!get_group(.)),
    sanitation_solidwastedisposal_disposed_open_grounds = percent_response(sanitation_solidwastedisposal, .,'disposed_open_grounds', group = !!get_group(.)),
    sanitation_solidwastedisposal_burnt_open_spaces = percent_response(sanitation_solidwastedisposal, .,'burnt_open_spaces', group = !!get_group(.)),
    sanitation_solidwastedisposal_not_managed = percent_response(sanitation_solidwastedisposal, .,'not_managed', group = !!get_group(.)),
    sanitation_solidwastedisposal_dnk = percent_response(sanitation_solidwastedisposal, .,'dnk', group = !!get_group(.)),
    sanitation_solidwastedisposal_other = percent_response(sanitation_solidwastedisposal, .,'other', group = !!get_group(.)),
    sanitation_access_impediments_top_1_name = select_percents(sanitation_access_impediments, 1, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_1_pct = select_percents(sanitation_access_impediments, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_impediments_top_2_name = select_percents(sanitation_access_impediments, 2, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_2_pct = select_percents(sanitation_access_impediments, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_impediments_top_3_name = select_percents(sanitation_access_impediments, 3, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_3_pct = select_percents(sanitation_access_impediments, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    sanitation_access_impediments_top_4_name = select_percents(sanitation_access_impediments, 4, ., questions, choices, 'label', group = !!get_group(.)),
    sanitation_access_impediments_top_4_pct = select_percents(sanitation_access_impediments, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    hygiene_handwashingfacilities_none = percent_response(hygiene_handwashingfacilities, .,'none', group = !!get_group(.)),
    hygiene_handwashingfacilities_few = percent_response(hygiene_handwashingfacilities, .,'few', group = !!get_group(.)),
    hygiene_handwashingfacilities_some = percent_response(hygiene_handwashingfacilities, .,'some', group = !!get_group(.)),
    hygiene_handwashingfacilities_many = percent_response(hygiene_handwashingfacilities, .,'many', group = !!get_group(.)),
    hygiene_handwashingfacilities_all = percent_response(hygiene_handwashingfacilities, .,'all', group = !!get_group(.)),
    hygiene_handwashingfacilities_dnk = percent_response(hygiene_handwashingfacilities, .,'dnk', group = !!get_group(.)),
    education_access_distance_min_less_15 = percent_response(education_access_distance_min, .,'less_15', group = !!get_group(.)),
    education_access_distance_min_15_30 = percent_response(education_access_distance_min, .,'15_30', group = !!get_group(.)),
    education_access_distance_min_31_60 = percent_response(education_access_distance_min, .,'31_60', group = !!get_group(.)),
    education_access_distance_min_more_60 = percent_response(education_access_distance_min, .,'more_60', group = !!get_group(.)),
    education_access_distance_min_dnk = percent_response(education_access_distance_min, .,'dnk', group = !!get_group(.)),
    education_facilities_primary = percent_response(education_facilities, .,'primary', group = !!get_group(.)),
    education_facilities_secondary = percent_response(education_facilities, .,'secondary', group = !!get_group(.)),
    education_facilities_quoranic = percent_response(education_facilities, .,'quoranic', group = !!get_group(.)),
    education_facilities_basic_edu = percent_response(education_facilities, .,'basic_edu', group = !!get_group(.)),
    education_facilities_no_available = percent_response(education_facilities, .,'no_available', group = !!get_group(.)),
    education_facilities_dnk = percent_response(education_facilities, .,'dnk', group = !!get_group(.)),
    education_facilities_other = percent_response(education_facilities, .,'other', group = !!get_group(.)),
    education_barriers_girls_top_1_name = select_percents(education_barriers_girls, 1, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_1_pct = select_percents(education_barriers_girls, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_girls_top_2_name = select_percents(education_barriers_girls, 2, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_2_pct = select_percents(education_barriers_girls, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_girls_top_3_name = select_percents(education_barriers_girls, 3, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_3_pct = select_percents(education_barriers_girls, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_girls_top_4_name = select_percents(education_barriers_girls, 4, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_girls_top_4_pct = select_percents(education_barriers_girls, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_1_name = select_percents(education_barriers_boys, 1, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_1_pct = select_percents(education_barriers_boys, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_2_name = select_percents(education_barriers_boys, 2, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_2_pct = select_percents(education_barriers_boys, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_3_name = select_percents(education_barriers_boys, 3, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_3_pct = select_percents(education_barriers_boys, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    education_barriers_boys_top_4_name = select_percents(education_barriers_boys, 4, ., questions, choices, 'label', group = !!get_group(.)),
    education_barriers_boys_top_4_pct = select_percents(education_barriers_boys, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_1_name = select_percents(aap_informationsources, 1, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_1_pct = select_percents(aap_informationsources, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_2_name = select_percents(aap_informationsources, 2, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_2_pct = select_percents(aap_informationsources, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_3_name = select_percents(aap_informationsources, 3, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_3_pct = select_percents(aap_informationsources, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_top_4_name = select_percents(aap_informationsources, 4, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_top_4_pct = select_percents(aap_informationsources, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_1_name = select_percents(aap_informationsources_pwd, 1, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_1_pct = select_percents(aap_informationsources_pwd, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_2_name = select_percents(aap_informationsources_pwd, 2, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_2_pct = select_percents(aap_informationsources_pwd, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_3_name = select_percents(aap_informationsources_pwd, 3, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_3_pct = select_percents(aap_informationsources_pwd, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_informationsources_pwd_top_4_name = select_percents(aap_informationsources_pwd, 4, ., questions, choices, 'label', group = !!get_group(.)),
    aap_informationsources_pwd_top_4_pct = select_percents(aap_informationsources_pwd, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_1_name = select_percents(aap_access_barriers, 1, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_1_pct = select_percents(aap_access_barriers, 1, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_2_name = select_percents(aap_access_barriers, 2, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_2_pct = select_percents(aap_access_barriers, 2, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_3_name = select_percents(aap_access_barriers, 3, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_3_pct = select_percents(aap_access_barriers, 3, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_access_barriers_top_4_name = select_percents(aap_access_barriers, 4, ., questions, choices, 'label', group = !!get_group(.)),
    aap_access_barriers_top_4_pct = select_percents(aap_access_barriers, 4, ., questions, choices, 'percent', group = !!get_group(.)),
    aap_feedbackmechanism_yes = percent_response(aap_feedbackmechanism, .,'yes', group = !!get_group(.)),
    aap_feedbackmechanism_no = percent_response(aap_feedbackmechanism, .,'no', group = !!get_group(.)),
    aap_feedbackmechanism_dnk = percent_response(aap_feedbackmechanism, .,'dnk', group = !!get_group(.)),
    covid_issue_yes = percent_response(covid_issue, .,'yes', group = !!get_group(.)),
    covid_issue_no = percent_response(covid_issue, .,'no', group = !!get_group(.)),
    covid_issue_dnk = percent_response(covid_issue, .,'dnk', group = !!get_group(.)),
    action_to_prevent_no_action = percent_response(action_to_prevent, .,'no_action', group = !!get_group(.)),
    action_to_prevent_not_all = percent_response(action_to_prevent, .,'not_all', group = !!get_group(.)),
    action_to_prevent_reducing_house = percent_response(action_to_prevent, .,'reducing_house', group = !!get_group(.)),
    action_to_prevent_stopping_contact = percent_response(action_to_prevent, .,'stopping_contact', group = !!get_group(.)),
    action_to_prevent_keeping_people = percent_response(action_to_prevent, .,'keeping_people', group = !!get_group(.)),
    action_to_prevent_avoiding_gatherings = percent_response(action_to_prevent, .,'avoiding_gatherings', group = !!get_group(.)),
    action_to_prevent_avoiding_transport = percent_response(action_to_prevent, .,'avoiding_transport', group = !!get_group(.)),
    action_to_prevent_wearing_mask = percent_response(action_to_prevent, .,'wearing_mask', group = !!get_group(.)),
    action_to_prevent_wearing_gloves = percent_response(action_to_prevent, .,'wearing_gloves', group = !!get_group(.)),
    action_to_prevent_washing_regularly = percent_response(action_to_prevent, .,'washing_regularly', group = !!get_group(.)),
    action_to_prevent_keeping_clean = percent_response(action_to_prevent, .,'keeping_clean', group = !!get_group(.)),
    action_to_prevent_praying_god = percent_response(action_to_prevent, .,'praying_god', group = !!get_group(.)),
    action_to_prevent_staying_animals = percent_response(action_to_prevent, .,'staying_animals', group = !!get_group(.)),
    action_to_prevent_other = percent_response(action_to_prevent, .,'other', group = !!get_group(.)),
    action_to_prevent_dnk = percent_response(action_to_prevent, .,'dnk', group = !!get_group(.)),
    snfi_score_1 = percent_response(snfi_score, .,'1', group = !!get_group(.)),
    snfi_score_2 = percent_response(snfi_score, .,'2', group = !!get_group(.)),
    snfi_score_3 = percent_response(snfi_score, .,'3', group = !!get_group(.)),
    snfi_score_4 = 0,
    wash_score_1 = percent_response(wash_score, .,'1', group = !!get_group(.)),
    wash_score_2 = percent_response(wash_score, .,'2', group = !!get_group(.)),
    wash_score_3 = percent_response(wash_score, .,'3', group = !!get_group(.)),
    wash_score_4 = percent_response(wash_score, .,'4', group = !!get_group(.)),
    protection_score_1 = percent_response(protection_score, .,'1', group = !!get_group(.)),
    protection_score_2 = percent_response(protection_score, .,'2', group = !!get_group(.)),
    protection_score_3 = percent_response(protection_score, .,'3', group = !!get_group(.)),
    protection_score_4 = percent_response(protection_score, .,'4', group = !!get_group(.)),
    fs_score_1 = percent_response(fs_score, .,'1', group = !!get_group(.)),
    fs_score_2 = percent_response(fs_score, .,'2', group = !!get_group(.)),
    fs_score_3 = percent_response(fs_score, .,'3', group = !!get_group(.)),
    fs_score_4 = percent_response(fs_score, .,'4', group = !!get_group(.)),
    health_score_1 = percent_response(health_score, .,'1', group = !!get_group(.)),
    health_score_2 = percent_response(health_score, .,'2', group = !!get_group(.)),
    health_score_3 = percent_response(health_score, .,'3', group = !!get_group(.)),
    health_score_4 = percent_response(health_score, .,'4', group = !!get_group(.)),
    nutrition_score_1 = percent_response(nutrition_score, .,'1', group = !!get_group(.)),
    nutrition_score_2 = percent_response(nutrition_score, .,'2', group = !!get_group(.)),
    nutrition_score_3 = percent_response(nutrition_score, .,'3', group = !!get_group(.)),
    nutrition_score_4 = 0,
    education_score_1 = percent_response(education_score, .,'1', group = !!get_group(.)),
    education_score_2 = percent_response(education_score, .,'2', group = !!get_group(.)),
    education_score_3 = percent_response(education_score, .,'3', group = !!get_group(.)),
    education_score_4 = percent_response(education_score, .,'4', group = !!get_group(.)),
    hlp_score_1 = percent_response(hlp_score, .,'1', group = !!get_group(.)),
    hlp_score_2 = percent_response(hlp_score, .,'2', group = !!get_group(.)),
    hlp_score_3 = percent_response(hlp_score, .,'3', group = !!get_group(.)),
    hlp_score_4 = percent_response(hlp_score, .,'4', group = !!get_group(.)),
    n_surveys = n()
  )

#### Finsal sectoral scores ####

data_merge_national <- data_merge_national %>% mutate(
  snfi_score = case_when(
    snfi_score_4 >= 25 ~ 4,
    rowSums(across(c(snfi_score_4,snfi_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(snfi_score_4,snfi_score_3,snfi_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  wash_score = case_when(
    wash_score_4 >= 25 ~ 4,
    rowSums(across(c(wash_score_4,wash_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(wash_score_4,wash_score_3,wash_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  protection_score = case_when(
    protection_score_4 >= 25 ~ 4,
    rowSums(across(c(protection_score_4,protection_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(protection_score_4,protection_score_3,protection_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  fs_score = case_when(
    fs_score_4 >= 25 ~ 4,
    rowSums(across(c(fs_score_4,fs_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(fs_score_4,fs_score_3,fs_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  health_score = case_when(
    health_score_4 >= 25 ~ 4,
    rowSums(across(c(health_score_4,health_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(health_score_4,health_score_3,health_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  nutrition_score = case_when(
    nutrition_score_4 >= 25 ~ 4,
    rowSums(across(c(nutrition_score_4,nutrition_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(nutrition_score_4,nutrition_score_3,nutrition_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  education_score = case_when(
    education_score_4 >= 25 ~ 4,
    rowSums(across(c(education_score_4,education_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(education_score_4,education_score_3,education_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  hlp_score = case_when(
    hlp_score_4 >= 25 ~ 4,
    rowSums(across(c(hlp_score_4,hlp_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(hlp_score_4,hlp_score_3,hlp_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ))

data_merge_ditrict <- data_merge_ditrict %>% mutate(
  snfi_score = case_when(
    snfi_score_4 >= 25 ~ 4,
    rowSums(across(c(snfi_score_4,snfi_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(snfi_score_4,snfi_score_3,snfi_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  wash_score = case_when(
    wash_score_4 >= 25 ~ 4,
    rowSums(across(c(wash_score_4,wash_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(wash_score_4,wash_score_3,wash_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  protection_score = case_when(
    protection_score_4 >= 25 ~ 4,
    rowSums(across(c(protection_score_4,protection_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(protection_score_4,protection_score_3,protection_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  fs_score = case_when(
    fs_score_4 >= 25 ~ 4,
    rowSums(across(c(fs_score_4,fs_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(fs_score_4,fs_score_3,fs_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  health_score = case_when(
    health_score_4 >= 25 ~ 4,
    rowSums(across(c(health_score_4,health_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(health_score_4,health_score_3,health_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  nutrition_score = case_when(
    nutrition_score_4 >= 25 ~ 4,
    rowSums(across(c(nutrition_score_4,nutrition_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(nutrition_score_4,nutrition_score_3,nutrition_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  education_score = case_when(
    education_score_4 >= 25 ~ 4,
    rowSums(across(c(education_score_4,education_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(education_score_4,education_score_3,education_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ),
  
  hlp_score = case_when(
    hlp_score_4 >= 25 ~ 4,
    rowSums(across(c(hlp_score_4,hlp_score_3)),na.rm = T) >= 25 ~ 3,
    rowSums(across(c(hlp_score_4,hlp_score_3,hlp_score_2)),na.rm = T) >= 25 ~ 2,
    TRUE ~ 1
  ))

###### Joining data ###### 

# colnames(data_merge_national)[1] <- colnames(data_merge_ditrict)[1] 
# 
# data_merge_output <- rbind(data_merge_national,data_merge_ditrict)
# 
# data_merge_output <- data_merge_output %>% 
#   mutate_if(is.numeric, round)
# 
# 
# 
# ###### Exporting the results ###### 
#  
# a <- list(data_merge_ditrict,data_merge_national) %>% bind_rows()
# 
# list(data[1]) 
# 
# map(list(data[1]),as.character) %>% View()
# 
# as.character()
# 
# write.csv(data_merge_output,"output/Data merge/data_merge_output_0903.csv",row.names = F)
# rio::export(data_merge_output,"output/Data merge/data_merge_output_0903.csv")
# 
# rio::export(data_merge_national,"output/Data merge/data_merge_output_1303_regional_v2.csv")
# rio::export(data_merge_ditrict,"output/Data merge/data_merge_output_1303_district_v2.csv")

write.csv(data_merge_national,"output/Data merge/data_merge_output_1303_regional_v3.csv",row.names = F,na = "NA")
write.csv(data_merge_ditrict,"output/Data merge/data_merge_output_1303_district_v3.csv",row.names = F,na = "NA")

  